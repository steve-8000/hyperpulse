# dYdX 운영 리포트

- 생성 시각: 2026-02-22T01:26:01.989Z
- RSS: Release protocol/v9.6.1-rc0
- 비교 기준(Base): 45a6958639b53f82b139d3fa649edf930ba3910d
- 최신 커밋(Head): 213eef5584fc94ab25462bc6ce42d01c4fd38a2e

## 한줄 요약
v9.6.1‑rc0 릴리즈는 주로 보안(geoblocking) 로직, 인덱서/데이터베이스 구조 변경과 함께 새로운 RPC 엔드포인트(클로브, 피트이어스 등) 도입을 포함한다.  주요 변경 사항은 헤더 처리 로직 교체, 새 쿼리/트랜잭션 모델 추가, 그리고 오래된 테이블(예: pnl, turnkey‑users 등) 삭제이다. 이로 인한 아카이브 노드와 운영자 측면에서 주의미를 검토한다.

## 운영자 중요 체크
- 아카이브 노드 운영(보관/색인/동기화) 관련 변경 단서가 감지되었습니다.
- 노드 설정값/프로토콜 플래그 관련 변경 단서가 감지되었습니다.

## 주요 변경점
- 주요 변경점 없음

## RPC/API 영향
- 해당 사항 없음

## 아카이브 노드 영향
- 테이블 삭제: `pnl`, `turnkey-users`, `bridge-information-table` 등. 아카이브 노드는 해당 테이블을 삭제하고, 오래된 데이터를 마이그레이션 해야 함.
- 새로운 `feetiers` 모델 도입으로 인한 스키마 변동이 있으나, 기존 데이터는 그대로 유지되므로 별도 마이그레이션 필요 없음.
- `block-table`, `funding-payments-table`, `oracle-price-table` 은 변동이 없으나, 새로 추가된 파일은 인덱서가 재빌드 필요.

## 운영 액션 아이템
- 헤더 로직 변경에 따라 클라이언트가 `cf-ipcountry` 헤더를 전달하도록 업데이트.
- 새로운 RPC 엔드포인트를 테스트하고, 클라이언트가 새 프로토콜을 사용하도록 버전 관리.
- 데이터베이스 마이그레이션 스크립트(테이블 삭제) 검증.
- 아카이브 노드 재배포 시 스키마 업데이트 및 데이터 마이그레이션 수행.

## 마이그레이션 체크리스트
- 기존 테이블(`pnl`, `turnkey-users`, `bridge-information-table`) 삭제 여부 확인.
- 새로운 프로토콜 파일(`feetiers`, `clob`) 이 정상적으로 빌드되는지 테스트.
- `isRestrictedCountryHeaders` 로직이 새 헤더(`cf-ipcountry`) 를 사용하도록 테스트.
- 새로운 RPC 엔드포인트가 기존 클라이언트에 미치는지 확인.
- 아카이브 노드에서 스키마 변경 후 데이터 마이그레이션 수행.

## 위험/주의 사항
- 헤더 이름이 `geo-origin-*`에서 `cf-ipcountry` 로 변경되었으며, 기존 클라이언트가 이 헤더를 사용해 접근할 경우 요청이 거부될 수 있다.
- 새로운 RPC 엔드포인트(예: `feetiers/query`, `clob/block_rate_limit_config`) 가 도입되었으나, 기존 클라이언트가 새 프로토콜을 호출하지 못할 경우 서비스 중단 위험이 있다.
- 테이블 삭제(예: `pnl`, `turnkey-users`) 로 인한 아카이브 노드의 스키마 마이그레이션 필요성.
- `setInstanceId()` 시그니처가 인자 없이 호출되도록 변경되어, 기존 스크립트에서 파라미터를 전달하던 부분이 실패할 수 있다.

## 근거(Evidence)
- "Change insert * and update * to declaring specific columns (backport #3047)"
- "Add safety check for sending builder codes to blocked address (backport #3308)"
- "Add update sub ticks per tick and step base quantums functionality (backport #3247)"

## 운영 메모
- 헤더 로직 변경은 클라이언트가 `geo-origin-*` 대신 `cf-ipcountry` 를 전달하도록 수정해야 함. 이는 API 호출 시 헤더를 재구성할 필요가 있다.
- 새로운 RPC 엔드포인트는 `proto` 파일이 업데이트되었으므로, 클라이언트가 새 프로토콜을 사용하도록 버전 관리가 필요하다.
- 테이블 삭제는 아카이브 노드에서 스키마를 재구성하고, 오래된 데이터를 마이그레이션 할 필요가 있다.

## 원문 커밋 내용
### Commit Log
```text
213eef55 upgrade cometbft and cosmos-sdk for tachyon security fix (backport #3320) (#3321)
ce73b61c Add safety check for sending builder codes to blocked address (backport #3308) (#3311)
3a99817e Update memclob on ClobPair Update. (backport #3306) (#3310)
0fc2c0ec 9.6 Upgrade (backport #3299) (#3304)
3e384fa4 [ENG-1340] Add update sub ticks per tick and step base quantums functionality (backport #3247) (#3302)
cea458bf Release/protocol/v9.5.x (#3277)
e40fc8cb fix x/stats GetStakedAmount and rename to GetStakedBaseTokens (backport #3238) (#3239)
d679e263 Remove staking weight as a calc for affiliate tiers (backport #3235) (#3237)
f8cfe79f Update TWAP Parent Store when Suborder is a Maker (backport #3094) (#3236)
e87b7581 Check Leverage on Withdrawals and Updates (Backport #3153) (#3223)
2f054150 Check Leverage On Order Placement (Backport #3141) (#3221)
c89128bd Add Leverage To the Protocol (backport #3079) (#3219)
0e18ac5b consider staking tiers when calculating fees (backport #3195) (#3204)
a87ec7e7 add staking tiers proto, query, and gov msg (backport #3134) (#3209)
d17ec14e Set upgrade to referred user goes to idx 2 (tier 3) (backport #3201) (#3202)
4c359cf2 Add market fee discount to protocol (backport #3130) (#3179)
d6fa308e 9.4 update (backport #3166) (#3172)
64ca4508 Integrate commission and overrides to fee tier calculation (Backport) (#3117) (#3191)
3e9b8ac3 Dont attribute new revenue if user exceeds 30d max volume and deprecate AffiliateWhitelist (Backport) (#3189)
8928b2a2 Change `insert *` and `update *` to declaring specific columns (backport #3047) (#3188)
da70b32e Change to warn instead of error for invalid ORRS (backport #3036) (#3186)
418ce423 Retroactive pr (backport #3033) (#3034)
fdaa1448 Rename proto fields to be a bit more clear (#3112) (#3178)
2bca3bce Create governance messages for sliding affiliate scheme (backport #3092) (#3175)
bf7418c1 fix v9.3 upgrade handler setup (backport #3159) (#3160)
df0f3a20 v9.3 upgrade (backport #3156) (#3157)
03a16252 Transfer Insurance Fund Payment Before Subaccount Update + e2e test (backport #3140) (#3154)
41424eb5 Revert "TEMPORARY FIX: SKIP ALL LIQUIDATIONS FOR CLOB PAIR 181 (#3137)" (backport #3142) (#3152)
eab3f04d upgrade cosmos-sdk and cometbft for security patch GHSA-hrhf-2vcr-ghch (backport #3148) (#3151)
fc042e16 TEMPORARY FIX: SKIP ALL LIQUIDATIONS FOR CLOB PAIR 181 (backport #3137) (#3138)
0e878fad upgrade cometbft and v9.1 (backport #3082) (#3084)
3b0e4145 Update err to log (backport #3056) (#3057)
d1effa68 Create new instance for fee calculation (backport #3051) (#3053)
e69ea3df [CT-1361] Add Support for TWAP Events in the Indexer (backport #2815) (#3042)
24add249 [CT-1365] Safely Handle Exceptions to TWAP Suborders (backport #3039) (#3041)
```

