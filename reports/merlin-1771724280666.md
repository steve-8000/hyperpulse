# Merlin 운영 리포트

- 생성 시각: 2026-02-22T01:38:00.666Z
- RSS: v2.0.3
- 비교 기준(Base): 4ac756e043425fe7fbfc97f27c6b7660365b0d34
- 최신 커밋(Head): cd29be667cd798e9f1f23d5dfb1b61d007b960a0

## 한줄 요약
이 릴리즈는 ZK‑EVM API와 데이터 스트림 클라이언트에 대한 버그 수정과 성능 개선을 주로 다루고 있다. 주요 변경 사항은 nil‑batch 처리 로직 추가, 스트리밍 제어킹 로직 리팩토링, 그리고 zkevm_counters에서 카운터 캐시 업데이트를 추가한 점이다. 이로 인해 RPC 호출 시 예외가 줄어들고, 스트리밍 중단 로직이 안정화된다.

## 운영자 중요 체크
- RPC/JSON-RPC 관련 변경 단서가 감지되었습니다.
- 아카이브 노드 운영(보관/색인/동기화) 관련 변경 단서가 감지되었습니다.
- 노드 설정값/프로토콜 플래그 관련 변경 단서가 감지되었습니다.

## 주요 변경점
- 주요 변경점 없음

## RPC/API 영향
- 해당 사항 없음

## 아카이브 노드 영향
- 아카이브 노드가 `GetBlockReceipts` 를 호출할 때 nil batch 시 빈 바이트 배열을 반환하므로, 기존에 `panic` 발생했던 상황이 해결된다. 따라서 아카이브 노드에서 별다른 조치가 필요 없다.
- 데이터 스트림 클라이언트의 `stopStreaming` 로직이 변경되었으나, 아카이브 노드가 스트리밍을 사용하지 않는다면 영향은 미미.

## 운영 액션 아이템
- go.mod 및 go.sum 의 zkevm-data-streamer 버전을 0.2.8 로 업데이트 후 `go mod tidy` 실행
- 스트리밍 클라이언트가 있는 노드라면 `allowStops` 플래그를 활성화하고, `stopStreaming()` 로직이 정상 동작하는지 테스트
- zkevm_counters 에서 카운터 캐시 업데이트가 정상 동작하는지 모니터링
- 데이터 스트림 클라이언트가 `stopStreaming` 호출 시 버퍼를 비우는 로직이 추가되었으므로, 네트워크 지연을 모니터링

## 마이그레이션 체크리스트
- go.mod/ go.sum 의 zkevm-data-streamer 버전 0.2.8 로 업데이트
- `GetBlockReceipts` 호출 시 nil batch 처리 로직이 정상 동작하는지 테스트
- 스트리밍 클라이언트가 있는 경우 `stopStreaming` 로직이 정상 동작하는지 테스트
- zkevm_counters 에서 카운터 캐시 업데이트가 정상 동작하는지 모니터링
- 프로덕션 환경에 배포 전 테스트 서버에서 RPC 호출 시 예외가 발생하지 않는지 확인

## 위험/주의 사항
- nil batch 처리 추가로 인해 `GetBlockReceipts` 호출 시 빈 바이트 배열이 반환될 수 있다. 기존에 panic 발생했던 상황을 방지하지만, 클라이언트가 빈 배열을 정상적으로 처리해야 한다.
- 데이터 스트림 클라이언트에서 `stopStreaming` 로직이 변경되면서 기존에 사용하던 `Stop()` 호출 시 내부 동작이 바뀜. 스트리밍 세션을 강제 종료할 때 버퍼를 비우는 로직이 추가되어, 네트워크 지연이 증가할 수 있다.
- zkevm_counters에서 카운터 캐시를 업데이트하는 로직이 추가되면서 메모리 사용량이 소폭 증가할 수 있다. 대규모 노드에서는 이 부분을 모니터링 해야 한다.

## 근거(Evidence)
- 근거 데이터 없음

## 운영 메모
- 데이터 스트림 클라이언트에서 `stopStreaming` 가 동기화된 버퍼를 비우는 로직이 추가되었다. 이는 스트리밍 세션 종료 시 버퍼를 비우는 비용을 증가시킬 수 있다.
- zkevm_api.go 에서 nil batch 처리 로직이 추가되었으나, `batchBlocks` 가 nil 이면 빈 바이트 배열을 반환한다. 클라이언트가 이를 정상적으로 처리해야 한다.
- zkevm_counters.go 에서 카운터 캐시를 업데이트하는 로직이 추가되었으나, 이 부분은 메모리 사용량에 영향을 줄 수 있다.

## 원문 커밋 내용
### Commit Log
```text
cd29be66 Merge pull request #24 from MerlinLayer2/feature/fix_getbatch
bcaffd5a fix for panic on getBatchByNumber on nil batch blocks
a80135fc Merge pull request #14 from MerlinLayer2/feature/update_datastream
cb258b09 update
fae73953 fix unreadable symbols
cd2e26e6 Merge pull request #13 from MerlinLayer2/feature/sync_fix_bug
866e86b5 fix eth_getBlockReceipts crash, add Creation check, add execution counters into account
```

