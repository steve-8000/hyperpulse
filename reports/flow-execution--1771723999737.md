# Flow(Execution) 운영 리포트

- 생성 시각: 2026-02-22T01:33:19.737Z
- RSS: v0.46.1-experimental-indexer.9
- 비교 기준(Base): 1651c1aa13e6d0ddd0fb569b0296963d465bd475
- 최신 커밋(Head): 2c4a94dade433e615fb70da1d86c2ae1c5514dd0

## 한줄 요약
본 커밋은 Flow의 FUNGIBLE TOKEN 이벤트 파싱 로직을 개선하여, Deposit 이벤트가 Withdrawal(출금)된 Vault에 입금될 때 그 Vault의 잔여량을 올려서 정상적으로 트랜잭션이 처리되도록 수정하였다.  기존에는 Deposit 이벤트가 단순히 새로 생성된 Vault에 대한 입금으로만 처리되었으나, 실제로는 출금(Withdrawal)으로 생성된 중간 Vault에 입금되는 경우가 존재한다. 이 로직을 추가함으로써, Mint(발행)된 토큰이 중간 Vault에 입금될 때 그 Vault의 잔여량을 올려서 이후 자식 트랜잭션에서도 정상적으로 처리되도록 하였다.  이는 Flow Staking Rewards 배포 패턴과 같은 시나리오를 지원한다.

## 운영자 중요 체크
- 아카이브 노드 운영(보관/색인/동기화) 관련 변경 단서가 감지되었습니다.

## 주요 변경점
- 주요 변경점 없음

## RPC/API 영향
- 해당 사항 없음

## 아카이브 노드 영향
- 아카이브 노드가 이벤트 파싱 로직을 그대로 사용한다면, 중간 Vault에 입금되는 Mint 이벤트가 정상적으로 인덱스되므로, 아카이브 노드의 저장소에 기록되는 트랜잭션 데이터가 정확해진다. 기존 아카이브 노드에 별도 영향은 없으나, 재배포 시 최신 버전으로 교체해야 함.

## 운영 액션 아이템
- 1. 최신 커밋을 pull 후, `go test ./...` 으로 테스트가 통과하는지 확인.
- 2. `state_synchronization` 모듈을 재배포하고, 이벤트 파싱 로직이 정상 동작하는지 모니터링.
- 3. 대량 트랜잭션(특히 중간 Vault 입금이 빈번 발생하는 경우)에서 성능 저하가 없는지 프로파일링.

## 마이그레이션 체크리스트
- 1. 최신 커밋을 pull 후, `go test ./...` 으로 테스트 통과 여부 확인.
- 2. `state_synchronization` 모듈을 재배포하고, 이벤트 파싱 로직이 정상 동작하는지 확인.
- 3. 기존에 파싱이 실패하던 트랜잭션(예: 중간 Vault 입금) 이 정상적으로 인덱스되는지 검증.
- 4. 대규모 트랜잭션에서 성능 저하가 없는지 프로파일링.

## 위험/주의 사항
- 1. Deposit 이벤트 파싱 로직이 변경되었으나, 기존 테스트 케이스가 충분히 커버리지되지 않은 경우 일부 트랜잭션에서 부정확한 입금/출금 매칭이 발생할 수 있다.
- 2. 새 파라미터(예: `1` 플래그)가 추가되었으나, 외부 API 혹은 RPC 호출에 직접적인 영향이 없지만 내부 테스트 유틸리티에서만 사용되므로, 외부 서비스에 대한 영향은 미미.
- 3. 이벤트 파싱 로직이 복잡해져서, 대량 트랜잭션(특히 중간 Vault에 대한 입금이 빈번 발생하는 경우)에서 성능 저하 가능성.

## 근거(Evidence)
- 근거 데이터 없음

## 운영 메모
- 1. 테스트 케이스가 추가된 시나리오를 통해, 중간 Vault에 입금되는 Mint 이벤트가 정상적으로 파싱되도록 보장.
- 2. `ft_group.go` 에서 추가된 로직은 `withdrawalByUUID` 맵을 활용해, 입금이 발생한 Vault의 잔여량을 올려서 이후 자식 트랜잭션에서 입금이 정상적으로 처리되도록 함. 이는 `ft_parser_test.go` 에서 추가된 테스트 케이스에서 확인 가능.
- 3. RPC/API/JSON‑RPC 레이어에는 직접적인 변경이 없으나, 내부 이벤트 파싱 로직이 바뀌었기에 `state_synchronization` 모듈을 재배포할 때, 기존에 파싱이 실패하던 트랜잭션(예: 중간 Vault 입금) 이 정상적으로 처리되도록 보장.

## 원문 커밋 내용
### Commit Log
```text
2c4a94dade fix bug in event parsing
```

