# Stratis 운영 리포트

- 생성 시각: 2026-02-22T01:47:52.132Z
- RSS: Masternode Contract Upgrade Activation (1.14.7)
- 비교 기준(Base): d36c0ad50418b316cc7a1edf670065482cff2b19
- 최신 커밋(Head): 0373d09dd8de34c553fbbfa74e2ff1045ed37007

## 한줄 요약
이 릴리즈는 Stratis 네트워크에서 MasterNode 하드포크를 도입하고, V2 버전을 추가한 내용이다. 핵심은 새로운 하드포크 로직을 삽입하고, 그에 따라 계약 코드와 헤더 검증 로직을 추가한 것이다. 1.14.7 버전에서는 두 개의 하드포크(기존과 V2)를 지원하도록 설정값을 추가하고, 실행 시점에 해당 포크를 적용한다.  이는 기존 노드가 두 가지 상황(포크 지원 여부, 포크 블록 번호)에 따라 동작하도록 바꾸는 로직이다. 1.14.7은 기존 코드에 비슷한 패턴으로 추가되었으며, 주요 변경 파일은 `consensus/misc/stratis_master_node.go`, `cmd/evm/internal/t8ntool/execution.go`, `consensus/beacon/consensus.go` 등이다. 이로 인해 노드가 새 포크를 인식하고, 계약 코드가 바뀌는 시점에 상태 DB에 적용된다.

## 운영자 중요 체크
- 아카이브 노드 운영(보관/색인/동기화) 관련 변경 단서가 감지되었습니다.
- 노드 설정값/프로토콜 플래그 관련 변경 단서가 감지되었습니다.

## 주요 변경점
- 주요 변경점 없음

## RPC/API 영향
- 해당 사항 없음

## 아카이브 노드 영향
- 아카이브 노드는 포크 블록 이후에 컨트랙트 코드가 바뀌는 시점에 상태 DB를 재구성해야 한다. 이는 `ApplyStratisMasterNodeHardFork` 가 호출되므로, 재인덱스가 필요하다.
- 포크 블록 이후에 새 컨트랙트 코드가 적용되므로, 아카이브 노드가 최신 상태를 유지하려면 재시작 후 전체 체인 재인덱스가 필요하다.

## 운영 액션 아이템
- 노드 소프트웨어를 1.14.7 로 업그레이드 한다.
- `StratisMasterNodeForkBlock`, `StratisMasterNodeForkV2Block` 과 같은 설정값을 체인 컨피그에 추가한다.
- 포크 블록 이후에 재시작 시, `ApplyStratisMasterNodeHardFork` 가 호출되도록 설정한다.
- 컨트랙트 바뀐 bytecode 를 `params.StratisMasterNodeContractBytecode` / `StratisMasterNodeV2ContractBytecode` 로 업데이트한다.

## 마이그레이션 체크리스트
- 1.14.7 버전으로 업그레이드 전, 현재 노드가 1.14.6 이라면 포크 블록 이후에 컨트랙트 코드가 바뀌는지 확인한다.
- `StratisMasterNodeForkBlock`, `StratisMasterNodeForkV2Block` 설정값이 있는지 확인한다.
- 포크 블록 이후에 재시작 시, 컨트랙트 코드가 바뀌는지 테스트한다.
- 아카이브 노드에 재인덱스가 필요하면, 인덱스 스크립트에 `ApplyStratisMasterNodeHardFork` 호출이 포함되었는지 확인한다.

## 위험/주의 사항
- 하드포크가 활성화되지 않은 노드는 새 포크 블록을 거부한다. 이때문제는 `ErrBadProStratisMasterNodeExtra` / `ErrBadNoStratisMasterNodeExtra` 에러가 발생한다. 1.14.7이 아닌 버전에서는 포크 블록 이후에 정상 동작하지 않을 수 있다.
- 컨트랙트 바뀐 bytecode 가 `params.StratisMasterNodeContract` 로 지정된다. 이 값이 잘못 설정되면 계약 호출 시 예외가 발생할 수 있다.
- V2 포크는 `StratisMasterNodeForkV2Block` 와 `StratisMasterNodeForkV2Support` 설정이 필요하다. 이 값이 없으면 V2 로직이 무시된다.
- 구형 노드(예: 1.14.6)에서 1.14.7 로 업그레이드 시, 포크 블록 이후에 상태 DB가 바뀌는 부분이 없으면 데이터 불일치 위험이 있다.

## 근거(Evidence)
- 근거 데이터 없음

## 운영 메모
- 하드포크 로직은 `StratisMasterNodeForkBlock`, `StratisMasterNodeForkV2Block` 설정에 따라 동작한다. 이 값은 `params/config.go` 에서 정의된다.
- 포크 적용 시, 컨트랙트 코드가 바뀌는 시점에 `ApplyStratisMasterNodeHardFork` / `ApplyStratisMasterNodeHardForkV2` 가 호출된다. 이는 상태 DB에 바로 적용되므로, 재시작이 필요하다.
- V2 포크는 `StratisMasterNodeForkV2Block` 가 설정되면, 헤더 검증 로직이 추가된다. 이때 `StratisMasterNodeV2BlockExtra` 가 필요하다.
- 기존 코드와 비교해 보면, `StratisMasterNodeForkSupport` 과 `StratisMasterNodeForkV2Support` 가 두 개의 플래그이다. 이 값이 false 인 경우, 포크 블록 이후에 헤더가 `StratisMasterNodeBlockExtra` 를 포함하면 에러를 발생시킨다.

## 원문 커밋 내용
### Commit Log
```text
0373d09 Upgraded blst package
baf67f2 Set StratisMasterNodeForkV2Block for mainnet
10ed91a StratisMasterNodeFork V2
2cd7f96 Set StratisMasterNodeForkBlock for Auroria
1f964eb Updated Stratis MN contract bytecode; use one MN bytecode for Auroria and Stratis networks
f77af14 Merge branch 'upgrade' into master_node_contract_hardfork
50c4bbe Updated Auroria genesis
72d89fc MasterNode contract code update
```

