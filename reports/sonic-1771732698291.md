# Sonic 운영 리포트

- 생성 시각: 2026-02-22T03:58:18.291Z
- RSS: v2.1.5-rc.1
- 비교 기준(Base): d71420e994e419a0260b429b066e50ca687d83ff
- 최신 커밋(Head): 4c1ac99a7ef4fe74edfb63443b9b64021a864de4

## 한줄 요약
본 릴리즈는 이벤트 발행을 제어하는 **Event Throttling** 기능이 추가되었으며, 이와 관련된 설정과 테스트가 대폭 확장되었습니다. 또한 RPC API에 `NewRPCPendingTransaction` 함수가 추가되고, eth_subscribe 옵션이 확장되었습니다. 이로 인해 노드 운영자는 이벤트 발행 정책을 재검토하고, 아카이브 노드가 과거 이벤트를 저장할 때 발생할 수 있는 부하를 주의미해야 합니다.

## 운영자 중요 체크
- RPC/JSON-RPC 관련 변경 단서가 감지되었습니다.
- 아카이브 노드 운영(보관/색인/동기화) 관련 변경 단서가 감지되었습니다.
- 노드 설정값/프로토콜 플래그 관련 변경 단서가 감지되었습니다.

## 주요 변경점
- 주요 변경점 없음

## RPC/API 영향
- NewRPCPendingTransaction 함수 추가
- eth_subscribe 옵션에 `fullTxs` 파라미터가 추가되어 전체 트랜잭션을 반환하도록 옵션이 확장

## 아카이브 노드 영향
- 이벤트 제어가 활성화되면 아카이브 노드가 저장하는 이벤트 수가 감소할 수 있다. 이는 과거 데이터 복구에 누락이 발생할 가능성을 내포한다.
- 제어 로직은 이벤트를 필터링하므로, 아카이브 노드가 과거 이벤트를 재구축할 때 필터링된 이벤트가 누락될 수 있다. 따라서 `archive` 옵션을 재검토하고 필요 시 필터링 비활성화 옵션을 적용해야 한다.

## 운영 액션 아이템
- 이벤트 제어를 활성화하려면 `--event-throttler` 플래그를 설정하고, `--event-throttler.dominant-threshold`, `--event-throttler.dominating-timeout`, `--event-throttler.non-dominating-timeout` 값을 적절히 조정한다.
- 이벤트 제어가 활성화되면 `emitter_config.ThrottlerConfig` 의 `Enabled`, `DominantStakeThreshold`, `DominatingTimeout`, `NonDominatingTimeout` 값을 검증한다.
- 새로운 RPC 함수(`NewRPCPendingTransaction`)가 도입되었으므로, 클라이언트 코드에 이 함수를 호출하도록 업데이트한다.
- `eth_subscribe` 옵션이 추가되었으므로, 클라이언트가 `fullTxs=true` 옵션을 지원하도록 업데이트한다.

## 마이그레이션 체크리스트
- config 파일에서 `Emitter` 필드를 `emitter_config.Config` 으로 교체한다.
- CLI 플래그에 `event-throttler` 옵션을 추가하고, 필요 시 활성화한다.
- 이벤트 제어 로직에 대한 테스트를 실행해 필터링 동작을 검증한다.
- 아카이브 노드가 과거 이벤트를 재구축할 때 필터링된 이벤트 누락 여부를 확인한다.
- 새로운 RPC 함수와 옵션이 도입되었으므로, 클라이언트/서버 간의 호환성 테스트를 수행한다.

## 위험/주의 사항
- 이벤트 발행 제어가 활성화되면 일부 이벤트(특히 저스테이크 비중앙형 검증자)가 필터링되어 저장되지 않을 수 있다. 이는 아카이브 노드가 과거 이벤트를 재구축할 때 누락되는 위험을 내포한다.
- 이벤트 제어 설정(특히 DominantStakeThreshold, Timeout 값)이 부적절정치로 설정되지 않으면 네트워크가 과도한 이벤트를 발생시켜서 성능 저하를 초래할 수 있다.
- 새로운 RPC 함수와 옵션이 기존 클라이언트에 호환성 이슈를 일으킬 수 있다. 특히 `eth_subscribe` 옵션이 추가되었기에 기존 클라이언트가 이 옵션을 인지하지 못하면 이벤트 수집이 비정상적으로 변할 위험이 있다.

## 근거(Evidence)
- 근거 데이터 없음

## 운영 메모
- 이벤트 제어는 `emitter_config` 패키지에 구현되었으며, 기존 `gossip/emitter/config.go`가 대대 변경되었다. 이로 인해 config 구조체와 flag 정의가 바뀌었음.
- 새로운 테스트(예: `dominant_set_test.go`, `throttler_simulation_test.go`)가 추가되었으며, 이벤트 필터링 로직이 복잡해졌음. 운영자는 테스트를 통해 정상 동작을 검증해야 한다.
- 아카이브 노드가 과거 이벤트를 재구축할 때, 제어 로직에 의해 필터링된 이벤트가 누락될 수 있으므로, `archive` 옵션을 재검토해야 한다.

## 원문 커밋 내용
### Commit Log
```text
4c1ac99a Rename event throttler flag (#633)
5b8f9d08 Add metrics to monitor skipping event emission. (#629)
65a11bbd Integrate event throttler (#626)
c5f7b2ca Add event throttler simulation (#623)
69402690 Add event throttling object (#622)
58d24883 Extend event throttler attendance testing. (#621)
113be16f Event emission throttling: Introduce attendance list (#620)
fce3382a Add dominant set computation for event throttling. (#617)
c3f8ce88 Update event throttler config (#618)
4dba6a77 Move emitter config to its own package (#615)
63ae97b1 Event throttling config (#610)
41764525 Add Integration test to test progress of network with validator stakes changes (#587)
cdc44bef Integration testing, Add option to define validator stakes (#568)
c33999e4 eth_subscribe: Add option to return full transactions (#589) (#613)
0b0ed7d8 Update version to v2.1.5-rc.1 development ready (#606)
```

